import{S as e,i as t,s as n,e as s,a as r,N as i,x as l,b as o,c as a,d as c,l as d,n as u,f as m,g as f,C as p,u as g,O as h,t as v,r as _,I as y,J as x,k as b,K as w}from"./main.js";import{f as E}from"./currency-0efccd32.js";import{g as k}from"./time-73fe1d75.js";import{g as I,c as D}from"./client-76b8804a.js";import{n as R}from"./quickNotifications-8de91e3f.js";import{c as $}from"./createStatusStore-326fc155.js";const N=$(),T="\n    id\n    amount\n    items {\n      description\n      price\n      quantity\n      amount\n    }\n    state\n    customer_first_name\n    customer_last_name\n    customer_address_line_1\n    customer_address_line_2\n    customer_postal_code\n    customer_locality\n    customer_country\n    created_at\n    payments {\n      id\n    }\n    student {\n      id\n    }\n    clss {\n      subject\n      times {\n        day\n        from\n        to\n      }\n      teacher {\n        first_name\n        last_name\n      }\n    }\n    ",P={GET:I`
    query ListAllInvoices($state: InvoiceState) {
      getInvoices(state: $state) {
        ${T}
      }
    }
  `,GET_BY_SEARCH_QUERY:I`
    query SearchInvoices($query: String!, $page_size: Int) {
      searchInvoices(query: $query, page_size: $page_size) {
        ${T}
      }
    }`},O={CREATE_PAYMENT:I`
    mutation CreatePayment($paymentInput: PaymentInput!) {
      createPayment(paymentInput: $paymentInput) {
        id
      }
    }
  `,DELETE_PAYMENT:I`
    mutation DeletePayment($id: ID!) {
      deletePayment(id: $id)
    }
  `,VOID:I`
    mutation VoidInvoice($id: ID!) {
      voidInvoice(id: $id) {
        id
      }
    }
  `,UNVOID:I`
    mutation UnvoidInvoice($id: ID!) {
      unvoidInvoice(id: $id) {
        id
      }
    }
  `,RESEND:I`
    mutation ResendInvoice($id: ID!) {
      resendInvoice(id: $id)
    }
  `};const j=function(){let e=[],t=[];function n(n){e=n;for(const n of t)n(e)}return{vd:async function(t){N.set("VOIDING");const{errors:s}=await D.request(O.VOID,{id:t});if(s)N.set("ERROR"),R.display({message:"Fehler: "+s[0].message,level:"error"});else{const s=e.findIndex(e=>e.id===t);e.splice(s,1),n(e),N.set("VOIDED"),R.display({message:"Rechnung wurde storniert."})}},set:n,unvd:async function(t){N.set("VOIDING");const{errors:s}=await D.request(O.UNVOID,{id:t});if(s)N.set("ERROR"),R.display({message:"Fehler: "+s[0].message,level:"error"});else{const s=e.findIndex(e=>e.id===t);e.splice(s,1),n(e),N.set("VOIDED"),R.display({message:"Rechnung wurde als 'offen' markiert."})}},fetch:async function({state:e}={}){N.set("FETCHING");const{data:t,errors:s}=await D.request(P.GET,{state:e});s?(N.set("ERROR"),R.display({message:"Fehler: "+s[0].message,level:"error"})):(n(t.getInvoices),N.set("FETCHED"))},resend:async function(e){N.set("RESENDING");const{errors:t}=await D.request(O.RESEND,{id:e});t?(N.set("ERROR"),R.display({message:"Fehler: "+t[0].message,level:"error"})):(N.set("RESENT"),R.display({message:"Rechnung wurde per E-Mail erneut gesendet."}))},search:async function(e,{page_size:t}={}){N.set("FETCHING");const{data:s,errors:r}=await D.request(P.GET_BY_SEARCH_QUERY,{query:e,page_size:t});r?(N.set("ERROR"),R.display({message:"Fehler: "+r[0].message,level:"error"})):(n(s.searchInvoices),N.set("FETCHED"))},subscribe:function(n){return t.push(n),n(e),function(){t=t.filter(e=>e!==n)}},createPayment:async function(t){N.set("CREATING_PAYMENT");const{errors:s}=await D.request(O.CREATE_PAYMENT,{paymentInput:t});if(s)N.set("ERROR"),R.display({message:"Fehler: "+s[0].message,level:"error"});else{const s=e.findIndex(e=>e.id===t.invoice_id);e.splice(s,1),n(e),N.set("PAYMENT_CREATED"),R.display({message:"Rechnung wurde bezahlt"})}},deletePayment:async function(t){N.set("DELETING_PAYMENT");const{errors:s}=await D.request(O.DELETE_PAYMENT,{id:t});s?(N.set("ERROR"),R.display({message:"Fehler: "+s[0].message,level:"error"})):(e=e.filter(e=>e.id!==t),n(e),N.set("PAYMENT_DELETED"),R.display({message:"Rechnung wurde als 'offen' markiert."}))}}}();function C(e,t,n){const s=e.slice();return s[21]=t[n],s[22]=t,s[23]=n,s}function A(e,t,n){const s=e.slice();return s[24]=t[n].description,s[25]=t[n].price,s[26]=t[n].quantity,s[27]=t[n].amount,s}function M(e){let t,n,i,l,u,f,p,g,h,y,x,b,w,E,k,I,D,R,$,N;return{c(){t=s("div"),n=s("input"),i=r(),l=s("label"),u=v("offen"),p=r(),g=s("input"),h=r(),y=s("label"),x=v("bezahlt"),w=r(),E=s("input"),k=r(),I=s("label"),D=v("storniert"),o(n,"class","hidden"),o(n,"type","radio"),o(n,"name","tabs"),o(n,"id","open"),n.__value="OPEN",n.value=n.__value,n.checked=!0,e[10][0].push(n),o(l,"for","open"),o(l,"class",f="block px-4 py-2 leading-none border-r border-teal-500 cursor-pointer "+("OPEN"===e[0]?"bg-teal-500 text-white":"text-teal-500")),o(g,"class","hidden"),o(g,"type","radio"),o(g,"name","tabs"),o(g,"id","paid"),g.__value="PAID",g.value=g.__value,e[10][0].push(g),o(y,"for","paid"),o(y,"class",b="block px-4 py-2 leading-none border-r border-teal-500 cursor-pointer "+("PAID"===e[0]?"bg-teal-500 text-white":"text-teal-500")),o(E,"class","hidden"),o(E,"type","radio"),o(E,"name","tabs"),o(E,"id","void"),E.__value="VOID",E.value=E.__value,e[10][0].push(E),o(I,"for","void"),o(I,"class",R="block px-4 py-2 leading-none cursor-pointer "+("VOID"===e[0]?"bg-teal-500 text-white":"text-teal-500")),o(t,"class","flex mb-6 overflow-hidden text-sm text-teal-500 border border-teal-500 rounded-md")},m(s,r){a(s,t,r),c(t,n),n.checked=n.__value===e[0],c(t,i),c(t,l),c(l,u),c(t,p),c(t,g),g.checked=g.__value===e[0],c(t,h),c(t,y),c(y,x),c(t,w),c(t,E),E.checked=E.__value===e[0],c(t,k),c(t,I),c(I,D),$||(N=[d(n,"change",e[9]),d(g,"change",e[11]),d(E,"change",e[12])],$=!0)},p(e,t){1&t&&(n.checked=n.__value===e[0]),1&t&&f!==(f="block px-4 py-2 leading-none border-r border-teal-500 cursor-pointer "+("OPEN"===e[0]?"bg-teal-500 text-white":"text-teal-500"))&&o(l,"class",f),1&t&&(g.checked=g.__value===e[0]),1&t&&b!==(b="block px-4 py-2 leading-none border-r border-teal-500 cursor-pointer "+("PAID"===e[0]?"bg-teal-500 text-white":"text-teal-500"))&&o(y,"class",b),1&t&&(E.checked=E.__value===e[0]),1&t&&R!==(R="block px-4 py-2 leading-none cursor-pointer "+("VOID"===e[0]?"bg-teal-500 text-white":"text-teal-500"))&&o(I,"class",R)},d(s){s&&m(t),e[10][0].splice(e[10][0].indexOf(n),1),e[10][0].splice(e[10][0].indexOf(g),1),e[10][0].splice(e[10][0].indexOf(E),1),$=!1,_(N)}}}function L(e){let t,n,r;return{c(){t=s("input"),o(t,"class","w-2/3 inp"),o(t,"type","text"),o(t,"placeholder","Suchen...")},m(s,i){a(s,t,i),n||(r=d(t,"input",e[8]),n=!0)},p:u,d(e){e&&m(t),n=!1,r()}}}function S(e){let t;return{c(){t=s("div"),t.textContent="keine Rechnungen"},m(e,n){a(e,t,n)},p:u,d(e){e&&m(t)}}}function q(e){let t,n,i,l,d=[],u=new Map,f=e[4];const p=e=>e[21].id;for(let t=0;t<f.length;t+=1){let n=C(e,f,t),s=p(n);u.set(s,d[t]=U(s,n))}return{c(){t=s("div"),n=s("header"),n.innerHTML='<div class="w-1/12 text-center">#</div> \n      <div class="w-2/12 text-center">Betrag</div> \n      <div class="w-2/12 text-center">Datum</div> \n      <div class="w-3/12">Name</div> \n      <div class="w-2/12 text-center">Status</div> \n      <div class="w-2/12 text-center"></div>',i=r(),l=s("ul");for(let e=0;e<d.length;e+=1)d[e].c();o(n,"class","hidden px-6 py-2 text-sm leading-none tracking-wide text-gray-600 bg-gray-200 border-b md:flex"),o(l,"class","bg-white"),o(t,"class","overflow-hidden border rounded shadow-md")},m(e,s){a(e,t,s),c(t,n),c(t,i),c(t,l);for(let e=0;e<d.length;e+=1)d[e].m(l,null)},p(e,t){208&t&&(f=e[4],d=y(d,t,p,1,e,f,u,l,x,U,null,C))},d(e){e&&m(t);for(let e=0;e<d.length;e+=1)d[e].d()}}}function V(e){let t;return{c(){t=s("p"),t.textContent="Loading..."},m(e,n){a(e,t,n)},p:u,d(e){e&&m(t)}}}function G(e){let t,n,i,l,c,u,f;function p(){return e[13](e[21])}function g(){return e[14](e[21])}function h(){return e[15](e[21])}return{c(){t=s("button"),t.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>',n=r(),i=s("button"),i.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="4.93" y1="4.93" x2="19.07" y2="19.07"></line></svg>',l=r(),c=s("button"),c.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>',o(t,"class","flex items-center justify-center w-8 h-8 mr-3 text-green-500 bg-green-100 rounded-full hover:text-green-600 hover:bg-green-200"),o(i,"class","flex items-center justify-center w-8 h-8 mr-3 text-red-500 bg-red-100 rounded-full hover:text-red-600 hover:bg-red-200"),o(c,"class","flex items-center justify-center w-8 h-8 text-blue-500 bg-blue-100 rounded-full hover:text-blue-600 hover:bg-blue-200")},m(e,s){a(e,t,s),a(e,n,s),a(e,i,s),a(e,l,s),a(e,c,s),u||(f=[d(t,"click",p),d(i,"click",g),d(c,"click",h)],u=!0)},p(t,n){e=t},d(e){e&&m(t),e&&m(n),e&&m(i),e&&m(l),e&&m(c),u=!1,_(f)}}}function H(e){let t,n,r;function i(){return e[16](e[21])}return{c(){t=s("button"),t.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>',o(t,"class","flex items-center justify-center w-8 h-8 text-green-500 bg-green-100 rounded-full hover:text-green-600 hover:bg-green-200")},m(e,s){a(e,t,s),n||(r=d(t,"click",i),n=!0)},p(t,n){e=t},d(e){e&&m(t),n=!1,r()}}}function F(e){let t,n,r;function i(){return e[17](e[21])}return{c(){t=s("button"),t.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>',o(t,"class","flex items-center justify-center w-8 h-8 text-green-500 bg-green-100 rounded-full hover:text-green-600 hover:bg-green-200")},m(e,s){a(e,t,s),n||(r=d(t,"click",i),n=!0)},p(t,n){e=t},d(e){e&&m(t),n=!1,r()}}}function Y(e){let t,n=e[21].items,r=[];for(let t=0;t<n.length;t+=1)r[t]=B(A(e,n,t));return{c(){t=s("footer");for(let e=0;e<r.length;e+=1)r[e].c();o(t,"class","px-6 py-3 text-gray-800")},m(e,n){a(e,t,n);for(let e=0;e<r.length;e+=1)r[e].m(t,null)},p(e,s){if(16&s){let i;for(n=e[21].items,i=0;i<n.length;i+=1){const l=A(e,n,i);r[i]?r[i].p(l,s):(r[i]=B(l),r[i].c(),r[i].m(t,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=n.length}},d(e){e&&m(t),w(r,e)}}}function z(e){let t,n,i,l=`Klasse: ${e[21].clss.subject} ${k(e[21].clss.times)} Lehrer: ${e[21].clss.teacher.last_name} ${e[21].clss.teacher.first_name}`;return{c(){t=s("div"),n=v(l),i=r()},m(e,s){a(e,t,s),c(t,n),c(t,i)},p(e,t){16&t&&l!==(l=`Klasse: ${e[21].clss.subject} ${k(e[21].clss.times)} Lehrer: ${e[21].clss.teacher.last_name} ${e[21].clss.teacher.first_name}`)&&b(n,l)},d(e){e&&m(t)}}}function B(e){let t,n,i,o,d=`${e[24]}, Preis: ${E.format(e[25]/100)}, Menge: ${e[26]}, Gesamt: ${E.format(e[27]/100)} `,u=e[21].clss&&z(e);return{c(){t=s("div"),n=v(d),i=r(),u&&u.c(),o=l()},m(e,s){a(e,t,s),c(t,n),a(e,i,s),u&&u.m(e,s),a(e,o,s)},p(e,t){16&t&&d!==(d=`${e[24]}, Preis: ${E.format(e[25]/100)}, Menge: ${e[26]}, Gesamt: ${E.format(e[27]/100)} `)&&b(n,d),e[21].clss?u?u.p(e,t):(u=z(e),u.c(),u.m(o.parentNode,o)):u&&(u.d(1),u=null)},d(e){e&&m(t),e&&m(i),u&&u.d(e),e&&m(o)}}}function U(e,t){let n,i,l,u,f,p,g,h,_,y,x,w,k,I,D,R,$,N,T,P,O,j,C,A,M,L,S,q,V,z,B,U,K,Q,J=t[21].id+"",W=E.format(t[21].amount/100)+"",X=new Date(1e3*t[21].created_at).toLocaleDateString()+"",Z=t[21].customer_first_name+" "+t[21].customer_last_name,ee=`${t[21].customer_address_line_2?t[21].customer_address_line_1+", "+t[21].customer_address_line_2:t[21].customer_address_line_1}, ${t[21].customer_postal_code+" "+t[21].customer_locality+", "+t[21].customer_country}`,te=t[6](t[21].state)+"",ne="OPEN"===t[21].state&&G(t),se="PAID"===t[21].state&&H(t),re="VOID"===t[21].state&&F(t),ie=t[21].showDetails&&Y(t);function le(){return t[18](t[21],t[22],t[23])}return{key:e,first:null,c(){n=s("li"),i=s("header"),l=s("div"),u=s("div"),f=v("MI"),p=v(J),g=r(),h=s("div"),_=s("div"),y=v(W),x=r(),w=s("div"),k=s("div"),I=v(X),D=r(),R=s("div"),$=s("div"),N=v(Z),T=r(),P=s("div"),O=v(ee),j=r(),C=s("div"),A=s("div"),M=v(te),S=r(),q=s("div"),ne&&ne.c(),V=r(),se&&se.c(),z=r(),re&&re.c(),B=r(),ie&&ie.c(),U=r(),o(l,"class","w-full mb-2 text-sm text-gray-700 sm:mb-0 sm:justify-center sm:items-center sm:w-1/12"),o(h,"class","w-full mb-2 sm:mb-0 sm:justify-center sm:items-center sm:w-2/12"),o(w,"class","w-full mb-2 sm:mb-0 sm:justify-center sm:items-center sm:w-2/12"),o(P,"class","text-sm text-gray-700"),o(R,"class","w-full mb-2 sm:mb-0 sm:w-3/12"),o(A,"class",L="px-4 py-1 text-sm leading-none text-"+t[7](t[21].state)+"-600 bg-"+t[7](t[21].state)+"-100 rounded-full"),o(C,"class","flex w-full mb-2 sm:mb-0 sm:justify-center sm:items-center sm:w-2/12"),o(q,"class","flex w-full mb-2 sm:mb-0 sm:justify-end sm:items-center sm:w-2/12"),o(i,"class","flex flex-wrap px-6 py-3 text-gray-800"),o(n,"class","border-b hover:bg-gray-100"),this.first=n},m(e,t){a(e,n,t),c(n,i),c(i,l),c(l,u),c(u,f),c(u,p),c(i,g),c(i,h),c(h,_),c(_,y),c(i,x),c(i,w),c(w,k),c(k,I),c(i,D),c(i,R),c(R,$),c($,N),c(R,T),c(R,P),c(P,O),c(i,j),c(i,C),c(C,A),c(A,M),c(i,S),c(i,q),ne&&ne.m(q,null),c(q,V),se&&se.m(q,null),c(q,z),re&&re.m(q,null),c(n,B),ie&&ie.m(n,null),c(n,U),K||(Q=d(n,"click",le),K=!0)},p(e,s){t=e,16&s&&J!==(J=t[21].id+"")&&b(p,J),16&s&&W!==(W=E.format(t[21].amount/100)+"")&&b(y,W),16&s&&X!==(X=new Date(1e3*t[21].created_at).toLocaleDateString()+"")&&b(I,X),16&s&&Z!==(Z=t[21].customer_first_name+" "+t[21].customer_last_name)&&b(N,Z),16&s&&ee!==(ee=`${t[21].customer_address_line_2?t[21].customer_address_line_1+", "+t[21].customer_address_line_2:t[21].customer_address_line_1}, ${t[21].customer_postal_code+" "+t[21].customer_locality+", "+t[21].customer_country}`)&&b(O,ee),16&s&&te!==(te=t[6](t[21].state)+"")&&b(M,te),16&s&&L!==(L="px-4 py-1 text-sm leading-none text-"+t[7](t[21].state)+"-600 bg-"+t[7](t[21].state)+"-100 rounded-full")&&o(A,"class",L),"OPEN"===t[21].state?ne?ne.p(t,s):(ne=G(t),ne.c(),ne.m(q,V)):ne&&(ne.d(1),ne=null),"PAID"===t[21].state?se?se.p(t,s):(se=H(t),se.c(),se.m(q,z)):se&&(se.d(1),se=null),"VOID"===t[21].state?re?re.p(t,s):(re=F(t),re.c(),re.m(q,null)):re&&(re.d(1),re=null),t[21].showDetails?ie?ie.p(t,s):(ie=Y(t),ie.c(),ie.m(n,U)):ie&&(ie.d(1),ie=null)},d(e){e&&m(n),ne&&ne.d(),se&&se.d(),re&&re.d(),ie&&ie.d(),K=!1,Q()}}}function K(e){let t,n,f,p,g,h,v,_,y,x,b,w,E,k,I,D;function R(e,t){return e[1]?L:M}let $=R(e),N=$(e);function T(e,t){return"FETCHING"===e[3]?V:e[4].length>0?q:S}let P=T(e),O=P(e);return{c(){t=s("h1"),t.textContent="Rechnungen",n=r(),f=s("div"),N.c(),p=r(),g=s("div"),h=s("button"),h.innerHTML='<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="stroke-current"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>',v=r(),_=s("a"),y=i("svg"),x=i("line"),b=i("line"),E=r(),O.c(),k=l(),o(h,"class","p-2 mr-3 text-teal-700 bg-gray-100 rounded-full hover:bg-teal-200"),o(x,"x1","12"),o(x,"y1","5"),o(x,"x2","12"),o(x,"y2","19"),o(b,"x1","5"),o(b,"y1","12"),o(b,"x2","19"),o(b,"y2","12"),o(y,"width","20"),o(y,"height","20"),o(y,"viewBox","0 0 24 24"),o(y,"fill","none"),o(y,"stroke","currentColor"),o(y,"stroke-width","2"),o(y,"stroke-linecap","round"),o(y,"stroke-linejoin","round"),o(y,"class","stroke-current"),o(_,"href",w=e[2]("./new")),o(_,"class","p-2 text-teal-700 bg-gray-100 rounded-full hover:bg-teal-200"),o(g,"class","flex items-center"),o(f,"class","flex items-baseline justify-between mb-6")},m(s,r){a(s,t,r),a(s,n,r),a(s,f,r),N.m(f,null),c(f,p),c(f,g),c(g,h),c(g,v),c(g,_),c(_,y),c(y,x),c(y,b),a(s,E,r),O.m(s,r),a(s,k,r),I||(D=d(h,"click",e[5]),I=!0)},p(e,[t]){$===($=R(e))&&N?N.p(e,t):(N.d(1),N=$(e),N&&(N.c(),N.m(f,p))),4&t&&w!==(w=e[2]("./new"))&&o(_,"href",w),P===(P=T(e))&&O?O.p(e,t):(O.d(1),O=P(e),O&&(O.c(),O.m(k.parentNode,k)))},i:u,o:u,d(e){e&&m(t),e&&m(n),e&&m(f),N.d(),e&&m(E),O.d(e),e&&m(k),I=!1,D()}}}function Q(e,t,n){let s,r,i;f(e,g,e=>n(2,s=e)),f(e,N,e=>n(3,r=e)),f(e,j,e=>n(4,i=e)),p.title="Rechnungen";let l="OPEN",o=!1;const a=[["OPEN","offen","yellow"],["PAID","bezahlt","teal"],["VOID","storniert","red"]];return e.$$.update=()=>{1&e.$$.dirty&&j.fetch({state:l,offset:"0",page_size:25})},[l,o,s,r,i,function(){o?(n(1,o=!1),j.fetch({state:l,offset:"0",page_size:25})):n(1,o=!0)},function(e){return a.find(t=>t[0]===e)[1]},function(e){return a.find(t=>t[0]===e)[2]},e=>j.search(e.target.value),function(){l=this.__value,n(0,l)},[[]],function(){l=this.__value,n(0,l)},function(){l=this.__value,n(0,l)},e=>j.createPayment({amount:e.amount,description:"SEPA Transfer",invoice_id:e.id}),e=>j.vd(e.id),e=>j.resend(e.id),e=>j.deletePayment(e.payments[0].id),e=>j.unvd(e.id),(e,t,n)=>h(j,t[n].showDetails=!e.showDetails,i)]}class J extends e{constructor(e){super(),t(this,e,Q,K,n,{})}}export{J as default};
//# sourceMappingURL=index-14a10a66.js.map

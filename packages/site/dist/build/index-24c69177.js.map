{"version":3,"file":"index-24c69177.js","sources":["../../src/stores/emails.js","../../src/pages/admins/emails/index.svelte"],"sourcesContent":["import { client, gql } from \"../utils/client\";\nimport { notifications } from \"./quickNotifications\";\nimport createStatusStore from \"../utils/createStatusStore\";\n\nconst status = createStatusStore();\n\nconst queries = {\n  GET: gql`\n    query ListAllEmailNotifications($offset: ID, $page_size: Int!) {\n      getEmailNotifications(offset: $offset, page_size: $page_size) {\n        id\n        subject\n        status\n        created_at\n        user {\n          id\n          first_name\n          last_name\n        }\n      }\n    }`,\n};\n\nfunction createEmailNotificationsStore() {\n  let emailNotifications = [];\n  let subs = [];\n\n  function subscribe(handler) {\n    subs.push(handler);\n    handler(emailNotifications);\n\n    return function unsubscribe() {\n      subs = subs.filter((fn) => fn !== handler);\n    };\n  }\n\n  function set(value) {\n    emailNotifications = value;\n    for (const fn of subs) fn(emailNotifications);\n  }\n\n  async function fetch(variables) {\n    status.set(\"FETCHING\");\n\n    const { data, errors } = await client.request(queries.GET, variables);\n\n    if (errors) {\n      status.set(\"ERROR\");\n\n      notifications.display({\n        message: \"Fehler: \" + errors[0].message,\n        level: \"error\",\n      });\n    } else {\n      set(data.getEmailNotifications);\n      status.set(\"FETCHED\");\n    }\n  }\n\n  return { subscribe, fetch };\n}\n\nconst emails = createEmailNotificationsStore();\n\nexport { emails, status };\n","<script>\n  import { emails, status } from \"../../../stores/emails\";\n  import { getTimeString } from \"../../../utils/time\";\n  import { metatags, url } from \"@roxi/routify\";\n\n  metatags.title = \"Versendete Emails\";\n  metatags.description = \"Description coming soon...\";\n\n  let emailStatus = \"SUCCESS\";\n  let offset = 0;\n  let page_size = 25;\n\n  $: emails.fetch({ status: emailStatus, offset, page_size });\n</script>\n\n<h1>Versendete Emails</h1>\n\n<div class=\"flex items-baseline justify-between\">\n  <div\n    class=\"flex mb-6 overflow-hidden text-sm text-teal-500 border border-teal-500 rounded-md\">\n    <input\n      class=\"hidden\"\n      type=\"radio\"\n      bind:group={emailStatus}\n      name=\"tabs\"\n      id=\"successful\"\n      value=\"SUCCESS\" />\n    <label\n      for=\"successful\"\n      class=\"block px-4 py-2 leading-none border-r border-teal-500\n      cursor-pointer {emailStatus === 'SUCCESS' ? 'bg-teal-500 text-white' : 'text-teal-500'}\">\n      Gesendet\n    </label>\n\n    <input\n      class=\"hidden\"\n      type=\"radio\"\n      bind:group={emailStatus}\n      name=\"tabs\"\n      id=\"failed\"\n      value=\"FAILURE\" />\n    <label\n      for=\"failed\"\n      class=\"block px-4 py-2 leading-none cursor-pointer {emailStatus === 'FAILURE' ? 'bg-teal-500 text-white' : 'text-teal-500'}\">\n      Fehlgeschlagen\n    </label>\n  </div>\n</div>\n\n{#if $status === 'FETCHING'}\n  <p>Loading...</p>\n{:else if $emails.length > 0}\n  <div class=\"overflow-hidden border rounded shadow-md\">\n    <header\n      class=\"hidden px-6 py-2 text-sm leading-none tracking-wide text-gray-600 bg-gray-200 border-b sm:flex\">\n      <div class=\"w-5/12\">Betreff</div>\n      <div class=\"w-3/12 text-center\">an</div>\n      <div class=\"w-2/12 text-center\">Status</div>\n      <div class=\"w-2/12 text-center\">Datum</div>\n    </header>\n    <ul class=\"bg-white\">\n      {#each $emails as email, index (email.id)}\n        <li\n          class=\"flex flex-wrap px-6 py-3 text-gray-800 border-b hover:bg-gray-100\">\n          <div class=\"w-full mb-2 sm:mb-0 sm:w-5/12\">\n            <div>{email.subject}</div>\n          </div>\n\n          <div class=\"flex w-full mb-2 text-gray-700 sm:items-center sm:justify-center sm:mb-0 sm:w-3/12\">\n            <a href={$url('../users/' + email.user.id)}>\n              {email.user.first_name + ' ' + email.user.last_name}\n            </a>\n          </div>\n\n          <div class=\"flex w-full mb-2 sm:items-center sm:justify-center sm:mb-0 sm:w-2/12\">\n            <div\n              class=\"text-sm leading-none py-1 px-4 rounded-full {email.status === 'SUCCESS' ? 'bg-green-200 text-green-700' : 'bg-red-200 text-red-700'}\">\n              {email.status === 'SUCCESS' ? 'Gesendet' : 'Fehlgeschlagen'}\n            </div>\n          </div>\n\n          <div class=\"flex w-full mb-2 sm:items-center sm:justify-center sm:mb-0 sm:w-2/12\">\n            <div>{new Date(email.created_at * 1000).toLocaleDateString()}</div>\n          </div>\n        </li>\n      {/each}\n    </ul>\n  </div>\n{:else}\n  <div>keine versendeten Emails</div>\n{/if}\n"],"names":["status","createStatusStore","queries","GET","gql","emails","emailNotifications","subs","subscribe","handler","push","filter","fn","fetch","async","variables","set","data","errors","client","request","notifications","display","message","level","value","getEmailNotifications","createEmailNotificationsStore","insert","target","div","anchor","ctx","get_key","id","length","i","div4","append","header","ul","p","t0_value","subject","user","first_name","last_name","t6_value","Date","created_at","toLocaleDateString","attr","a","a_href_value","li","div1","div0","div2","div3","div6","div5","dirty","set_data","t0","t2","t2_value","t4","t4_value","t6","create_if_block","create_if_block_1","label0","label0_class_value","label1","label1_class_value","h1","input0","input1","metatags","title","description","emailStatus","offset","page_size","this","__value"],"mappings":"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"}